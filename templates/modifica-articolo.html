<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Modifica Articolo - Sistema DDT</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <nav>
            <ul>
                <li><a href="/">üè† Dashboard</a></li>
                <li><a href="/ddt-in">üì• DDT IN</a></li>
                <li><a href="/ddt-out">üì§ DDT OUT</a></li>
                <li><a href="/catalogo">üìö Catalogo</a></li>
                <li><a href="/inventario">üì¶ Inventario</a></li>
            </ul>
        </nav>

        <div class="ddt-header">
            <h1>‚úèÔ∏è Modifica Articolo</h1>
            <div class="buttons">
                <button type="button" class="btn btn-secondary" onclick="window.location.href='/catalogo'">‚Üê Torna al Catalogo</button>
            </div>
        </div>

        <div class="form-container">
            <form method="POST" action="/catalogo/modifica/{{ articolo.id }}">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="codice_interno">Codice Interno *</label>
                        <input type="text" id="codice_interno" name="codice_interno" 
                               value="{{ articolo.codice_interno }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="codice_fornitore">Codice Fornitore</label>
                        <input type="text" id="codice_fornitore" name="codice_fornitore" 
                               value="{{ articolo.codice_fornitore or '' }}">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="descrizione">Descrizione *</label>
                        <input type="text" id="descrizione" name="descrizione" 
                               value="{{ articolo.descrizione }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="fornitore_principale">Fornitore Principale</label>
                        <select id="fornitore_principale" name="fornitore_principale">
                            <option value="">Seleziona fornitore</option>
                            {% for fornitore in fornitori %}
                            <option value="{{ fornitore.ragione_sociale }}" 
                                    {{ 'selected' if articolo.fornitore_principale == fornitore.ragione_sociale else '' }}>
                                {{ fornitore.ragione_sociale }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="codice_produttore">Codice Produttore</label>
                        <input type="text" id="codice_produttore" name="codice_produttore" 
                               value="{{ articolo.codice_produttore or '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="unita_misura">Unit√† di Misura</label>
                        <select id="unita_misura" name="unita_misura">
                            <option value="PZ" {{ 'selected' if (articolo.unita_misura or 'PZ') == 'PZ' else '' }}>PZ</option>
                            <option value="MT" {{ 'selected' if articolo.unita_misura == 'MT' else '' }}>MT</option>
                            <option value="KG" {{ 'selected' if articolo.unita_misura == 'KG' else '' }}>KG</option>
                            <option value="LT" {{ 'selected' if articolo.unita_misura == 'LT' else '' }}>LT</option>
                            <option value="M2" {{ 'selected' if articolo.unita_misura == 'M2' else '' }}>M¬≤</option>
                            <option value="M3" {{ 'selected' if articolo.unita_misura == 'M3' else '' }}>M¬≥</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="costo_ultimo">Costo Ultimo ‚Ç¨</label>
                        <input type="number" id="costo_ultimo" name="costo_ultimo" 
                               step="0.01" min="0" value="{{ articolo.costo_ultimo or 0 }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="giacenza_attuale">Giacenza Attuale</label>
                        <input type="number" id="giacenza_attuale" name="giacenza_attuale" 
                               step="0.01" min="0" value="{{ articolo.giacenza_attuale or 0 }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="scorta_minima">Scorta Minima</label>
                        <input type="number" id="scorta_minima" name="scorta_minima" 
                               step="0.01" min="0" value="{{ articolo.scorta_minima or 0 }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="ubicazione">Ubicazione/Magazzino</label>
                        <select id="ubicazione" name="ubicazione">
                            <option value="">Seleziona ubicazione</option>
                            {% for magazzino in magazzini %}
                            <option value="{{ magazzino.descrizione }}" 
                                    {{ 'selected' if articolo.ubicazione == magazzino.descrizione else '' }}>
                                {{ magazzino.descrizione }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="note">Note</label>
                        <textarea id="note" name="note" rows="3">{{ articolo.note or '' }}</textarea>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn">üíæ Salva Modifiche</button>
                    <button type="button" class="btn btn-secondary" onclick="window.location.href='/catalogo'">‚ùå Annulla</button>
                    <button type="button" class="btn btn-danger" onclick="confermaEliminazione()">üóëÔ∏è Elimina Articolo</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Form nascosto per eliminazione -->
    <form id="formElimina" method="POST" action="/catalogo/elimina/{{ articolo.id }}" style="display: none;">
    </form>

    <script>
    function confermaEliminazione() {
        if (confirm('Sei sicuro di voler eliminare questo articolo?\n\n"{{ articolo.codice_interno }} - {{ articolo.descrizione }}"\n\nQuesta azione non pu√≤ essere annullata.')) {
            document.getElementById('formElimina').submit();
        }
    }
    </script>

    <style>
    .form-container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin: 20px 0;
    }
    
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .form-group.full-width {
        grid-column: span 2;
    }
    
    .form-group label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
        color: #333;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
    }
    
    .form-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-start;
        border-top: 1px solid #eee;
        padding-top: 20px;
    }
    
    .btn-danger {
        background: #dc3545;
        color: white;
        margin-left: auto;
    }
    
    .btn-danger:hover {
        background: #c82333;
    }
    
    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }
        
        .form-group.full-width {
            grid-column: span 1;
        }
        
        .form-actions {
            flex-direction: column;
        }
    }
    </style>
</body>
</html>