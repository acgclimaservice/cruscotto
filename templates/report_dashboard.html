<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Esecutivo - Sistema DDT</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
</head>
<body>
    <div class="container">
        <nav>
            <ul>
                <li><a href="/">üè† Dashboard</a></li>
                <li><a href="/reports">üìä Report</a></li>
                <li><a href="/reports/dashboard" class="active">üéØ Dashboard Esecutivo</a></li>
            </ul>
        </nav>

        <div class="ddt-header">
            <h1>üéØ Dashboard Esecutivo</h1>
            <div style="margin-top: 15px;">
                <button onclick="window.print()" class="btn btn-secondary">üñ®Ô∏è Stampa</button>
                <button onclick="exportReport('dashboard')" class="btn btn-success">üìä Export Excel</button>
            </div>
        </div>

        <!-- KPI Principali -->
        <div class="card">
            <h3>üìà Indicatori Chiave di Performance (KPI)</h3>
            <div class="info-grid" style="margin-top: 20px;">
                <div class="info-item {{ 'warning' if kpi.ddt_in_confermati < kpi.ddt_in_totali * 0.8 else 'success' }}">
                    <span class="info-label">DDT IN Totali</span>
                    <span class="info-value">{{ kpi.ddt_in_totali }}</span>
                </div>
                <div class="info-item {{ 'success' if kpi.ddt_in_confermati > 0 else 'warning' }}">
                    <span class="info-label">DDT IN Confermati</span>
                    <span class="info-value">{{ kpi.ddt_in_confermati }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">DDT OUT Totali</span>
                    <span class="info-value">{{ kpi.ddt_out_totali }}</span>
                </div>
                <div class="info-item {{ 'success' if kpi.ddt_out_confermati > 0 else 'warning' }}">
                    <span class="info-label">DDT OUT Confermati</span>
                    <span class="info-value">{{ kpi.ddt_out_confermati }}</span>
                </div>
                <div class="info-item {{ 'success' if kpi.valore_inventario > 1000 else 'warning' }}">
                    <span class="info-label">Valore Inventario</span>
                    <span class="info-value">‚Ç¨ {{ "{:,.2f}".format(kpi.valore_inventario) }}</span>
                </div>
                <div class="info-item {{ 'warning' if kpi.articoli_critici > 5 else 'success' }}">
                    <span class="info-label">Articoli Critici</span>
                    <span class="info-value">{{ kpi.articoli_critici }}</span>
                </div>
            </div>
        </div>

        <!-- Sezione Preventivi e Offerte -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
            
            <!-- Preventivi -->
            <div class="card">
                <h3>üìã Preventivi</h3>
                <div class="info-grid" style="margin-top: 15px;">
                    <div class="info-item">
                        <span class="info-label">Totale Preventivi</span>
                        <span class="info-value">{{ kpi.preventivi_totali }}</span>
                    </div>
                    <div class="info-item {{ 'success' if kpi.preventivi_accettati > 0 else 'warning' }}">
                        <span class="info-label">Preventivi Accettati</span>
                        <span class="info-value">{{ kpi.preventivi_accettati }}</span>
                    </div>
                </div>
                <div style="margin-top: 15px; text-align: center;">
                    <div class="progress-circle" style="display: inline-block; position: relative; width: 120px; height: 120px;">
                        <svg width="120" height="120" style="transform: rotate(-90deg);">
                            <circle cx="60" cy="60" r="50" fill="none" stroke="#e0e0e0" stroke-width="8"/>
                            <circle cx="60" cy="60" r="50" fill="none" stroke="#28a745" stroke-width="8"
                                    stroke-dasharray="{{ (kpi.conversion_rate_preventivi * 3.14159) }}, 314.159"/>
                        </svg>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold; color: #28a745;">
                            {{ "{:.1f}".format(kpi.conversion_rate_preventivi) }}%
                        </div>
                    </div>
                    <div style="margin-top: 10px; color: #666; font-size: 0.9em;">Tasso Conversione</div>
                </div>
            </div>

            <!-- Offerte -->
            <div class="card">
                <h3>üè¢ Offerte Fornitori</h3>
                <div class="info-grid" style="margin-top: 15px;">
                    <div class="info-item">
                        <span class="info-label">Totale Offerte</span>
                        <span class="info-value">{{ kpi.offerte_totali }}</span>
                    </div>
                    <div class="info-item {{ 'success' if kpi.offerte_accettate > 0 else 'warning' }}">
                        <span class="info-label">Offerte Accettate</span>
                        <span class="info-value">{{ kpi.offerte_accettate }}</span>
                    </div>
                </div>
                <div style="margin-top: 15px; text-align: center;">
                    <div class="progress-circle" style="display: inline-block; position: relative; width: 120px; height: 120px;">
                        <svg width="120" height="120" style="transform: rotate(-90deg);">
                            <circle cx="60" cy="60" r="50" fill="none" stroke="#e0e0e0" stroke-width="8"/>
                            <circle cx="60" cy="60" r="50" fill="none" stroke="#007bff" stroke-width="8"
                                    stroke-dasharray="{{ (kpi.conversion_rate_offerte * 3.14159) }}, 314.159"/>
                        </svg>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold; color: #007bff;">
                            {{ "{:.1f}".format(kpi.conversion_rate_offerte) }}%
                        </div>
                    </div>
                    <div style="margin-top: 10px; color: #666; font-size: 0.9em;">Tasso Accettazione</div>
                </div>
            </div>

        </div>

        <!-- Analisi Rapida -->
        <div class="card" style="margin-top: 20px;">
            <h3>üîç Analisi Rapida</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                
                <div style="padding: 15px; border-left: 4px solid #28a745; background: #f8f9fa;">
                    <h4 style="color: #28a745; margin: 0 0 10px 0;">üìä Performance DDT</h4>
                    <p style="margin: 0; color: #666;">
                        Tasso conferma DDT IN: {{ "{:.1f}".format((kpi.ddt_in_confermati / kpi.ddt_in_totali * 100) if kpi.ddt_in_totali > 0 else 0) }}%<br>
                        Tasso conferma DDT OUT: {{ "{:.1f}".format((kpi.ddt_out_confermati / kpi.ddt_out_totali * 100) if kpi.ddt_out_totali > 0 else 0) }}%
                    </p>
                </div>

                <div style="padding: 15px; border-left: 4px solid #ffc107; background: #fff8e1;">
                    <h4 style="color: #ff8f00; margin: 0 0 10px 0;">‚ö†Ô∏è Alert Magazzino</h4>
                    <p style="margin: 0; color: #666;">
                        {% if kpi.articoli_critici > 0 %}
                            {{ kpi.articoli_critici }} articoli sotto scorta minima<br>
                            <strong>Azione richiesta</strong>
                        {% else %}
                            Tutti gli articoli sopra scorta minima<br>
                            <strong>Situazione normale</strong>
                        {% endif %}
                    </p>
                </div>

                <div style="padding: 15px; border-left: 4px solid #007bff; background: #f0f8ff;">
                    <h4 style="color: #007bff; margin: 0 0 10px 0;">üí∞ Valore Business</h4>
                    <p style="margin: 0; color: #666;">
                        Inventario: ‚Ç¨ {{ "{:,.0f}".format(kpi.valore_inventario) }}<br>
                        Media per articolo: ‚Ç¨ {{ "{:.2f}".format(kpi.valore_inventario / 20 if kpi.valore_inventario > 0 else 0) }}
                    </p>
                </div>

            </div>
        </div>

        <!-- Collegamenti Rapidi -->
        <div class="card" style="margin-top: 20px;">
            <h3>üîó Approfondimenti</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                <button onclick="window.location.href='/reports/movimenti'" class="btn btn-success">
                    üì¶ Dettaglio Movimenti
                </button>
                <button onclick="window.location.href='/reports/fornitori'" class="btn btn-info">
                    üè¢ Analisi Fornitori
                </button>
                <button onclick="window.location.href='/reports/articoli'" class="btn btn-warning">
                    üìã Report Articoli
                </button>
                <button onclick="window.location.href='/inventario'" class="btn btn-secondary">
                    üìä Visualizza Inventario
                </button>
            </div>
        </div>

    </div>

    <script>
    function exportReport(type) {
        window.location.href = `/reports/export/${type}`;
    }

    // Update ogni 30 secondi
    setInterval(function() {
        window.location.reload();
    }, 30000);
    </script>

    <style>
    .info-item.success .info-value {
        color: #28a745;
        font-weight: bold;
    }

    .info-item.warning .info-value {
        color: #ffc107;
        font-weight: bold;
    }

    .progress-circle circle {
        transition: stroke-dasharray 0.8s ease;
    }

    @media print {
        nav { display: none; }
        .btn { display: none; }
        .card { page-break-inside: avoid; }
    }
    </style>
</body>
</html>