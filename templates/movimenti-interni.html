<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Movimenti Interni</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header aziendale con logo -->
        <div class="company-header">
            <div class="company-logo">
                <img src="{{ url_for('static', filename='logo-acg.png') }}" alt="ACG Clima Service" class="logo-img">
            </div>
            <div class="company-info">
                <h1 class="company-name">ACG Clima Service S.r.l.</h1>
                <div class="company-details">
                    <p><strong>Sede Legale:</strong> Via Duccio Galimberti 47 - 15121 Alessandria (AL)</p>
                    <p><strong>Sede Operativa:</strong> Via Zanardi Bonfiglio 68 - 27058 Voghera (PV)</p>
                    <p>Tel: 0383/640606 | Email: info@acgclimaservice.com</p>
                    <p>P.IVA: 02735970069 | C.F: 02735970069</p>
                </div>
            </div>
            <div class="system-info">
                <h2>Movimenti Interni</h2>
                <p>Spostamento articoli tra magazzini</p>
            </div>
        </div>

        <nav>
            <ul>
                <li><a href="/">üè† Dashboard</a></li>
                <li><a href="/ddt-in">üì• DDT IN</a></li>
                <li><a href="/ddt-out">üì§ DDT OUT</a></li>
                <li><a href="/inventario">üì¶ Inventario</a></li>
                <li><a href="/movimenti-interni" class="active">üîÑ Movimenti Interni</a></li>
            </ul>
        </nav>

        <div class="page-header">
            <h1>üîÑ Movimenti Interni</h1>
            <button class="btn btn-primary" onclick="window.location.href='/movimenti-interni/nuovo'">
                ‚ûï Nuovo Movimento
            </button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Numero</th>
                        <th>Data</th>
                        <th>Da Magazzino</th>
                        <th>A Magazzino</th>
                        <th>Causale</th>
                        <th>Stato</th>
                        <th>Azioni</th>
                    </tr>
                </thead>
                <tbody>
                    {% for movimento in movimenti %}
                    <tr>
                        <td>{{ movimento.numero_documento or 'BOZZA' }}</td>
                        <td>{{ movimento.data_movimento.strftime('%d/%m/%Y') if movimento.data_movimento else '-' }}</td>
                        <td>{{ movimento.nome_magazzino_partenza or '-' }}</td>
                        <td>{{ movimento.nome_magazzino_destinazione or '-' }}</td>
                        <td>{{ movimento.causale or '-' }}</td>
                        <td>
                            <span class="status {{ 'confirmed' if movimento.stato == 'confermato' else 'draft' }}">
                                {{ movimento.stato|upper }}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm" onclick="window.location.href='/movimenti-interni/{{ movimento.id }}'">
                                üëÅÔ∏è Visualizza
                            </button>
                            {% if movimento.stato == 'bozza' %}
                                <button class="btn btn-sm btn-warning" onclick="window.location.href='/movimenti-interni/{{ movimento.id }}/modifica'">
                                    ‚úèÔ∏è Modifica
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="eliminaMovimento({{ movimento.id }})">
                                    üóëÔ∏è Elimina
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7" class="no-data">Nessun movimento interno trovato</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function eliminaMovimento(movimentoId) {
            if (confirm('Sei sicuro di voler eliminare questo movimento interno?\n\nQuesta azione non pu√≤ essere annullata.')) {
                fetch(`/movimenti-interni/${movimentoId}/elimina`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Movimento eliminato con successo');
                        window.location.reload();
                    } else {
                        alert('Errore: ' + (data.error || 'Errore sconosciuto'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Errore di rete: ' + error.message);
                });
            }
        }
    </script>
</body>
</html>